---
date: 2022-01-30T14:34:36+08:00  # 创建日期
author: "Rustle Karl"  # 作者

# 文章
title: "第3章_GCC编译器与调试器"  # 文章标题
# description: "文章描述"
url:  "posts/cpp/docs/[Linux]C/第3章_GCC编译器与调试器"  # 设置网页永久链接
tags: [ "cpp" ]  # 标签
series: [ "C/C++ 学习笔记"]  # 文章主题/文章系列
categories: [ "学习笔记"]  # 文章分类

# 章节
weight: 20 # 排序优先级
chapter: false  # 设置为章节

index: true  # 是否可以被索引
toc: true  # 是否自动生成目录
draft: false  # 草稿
---

## GCC/G++编译器

GCC 是 GNU 项目中的一个子项目，最初为用于编译 C 语言的编译器。随着 GNU 项目的发展，GCC 已经成为了能编译 C、C++、Ada、Object C 和 Java 等语言的 GNU 编译器家族，同时还可执行跨硬件平台的交叉编译工作。G++ 则是专门用来编译 C 和 C++ 语言的编译器。C 和 C++ 语言正在不断发展，为了保持兼容程序语言的最新特性，开发者通常选择 GCC 来编译 C 语言编写的源代码，选择 G++来编译 C++ 源代码。

### GCC/G++编译器的安装

```shell
apt install make gcc -y
```

### GCC/G++编译命令

```shell
gcc [-选项1][-选项2]…[-选项n]<源文件名>
g++ [-选项1][-选项2]…[-选项n]<源文件名>
```

### GCC/G++编译选项

GCC 拥有一百多个编译选项。对于 C 语言和 C++ 语言，G++ 与 GCC 的编译选项基本相同。常用的 GCC 和 G++ 编译选项见表 3.1。

![](../assets/images/表3.1_常用编译选项.png)

### GCC/G++编译器的执行过程

GCC 和 G++ 编译器执行过程可总结为 4 步：预处理、编译、汇编和连接。

在预处理过程中，编译器会对源代码中的头文件和预处理语句进行分析，生成以 `.i` 为后缀的预处理文件。

编译过程是将输入的源代码编译为以 `.o` 为后缀的目标文件。

汇编过程是针对汇编语言的步骤，编译后生成以 `.o` 为后缀的目标文件。

最后执行连接过程，所有的目标文件被安排在可执行程序中恰当的位置。同时，该程序所调用到的库函数也从各自所在的档案库中连到合适的地方，如图 3.1 所示。

![](../assets/images/图3.1_编译器执行过程.png)

## 程序和进程

程序是可运行的一组指令，以二进制代码的形式保存在存储设备中。操作系统运行程序后，该程序在内存中的映像就是进程，进程是活动的程序。

### 程序

程序是指一组指示计算机或其他具有信息处理能力设备每一步动作的指令。

Linux 系统下的应用程序主要由两种特殊类型的文件代表，分别是可执行文件和脚本程序。

可执行文件是能够被计算机直接执行的程序，相当于 Windows 系统中的 exe 文件。使用 C 和 C++ 语言设计的程序编译后即是可执行文件。Linux 系统不要求可执行文件使用特定的扩展名，文件是否能被执行由文件的系统属性来决定。

### 进程和PID

进程是一个具有独立功能的程序关于某个数据集合的一次可以并发执行的运行活动，是处于活动状态的程序。进程作为构成系统的基本元件，不仅是系统内部独立运行的实体，而且是独立竞争资源的实体。

在 Linux 系统中，用户创建进程时会先在系统的进程表中为进程创建独一无二的编码，即 PID。PID 是一个正整数，其取值范围是 2 ~ 32768。进程创建时会顺序挑选下一个未使用的编号数字作为自己的 PID。如果它们已经经过一圈的循环，新的编码将重新从 2 开始。数字 1 一般是为特殊进程 init 保留的，它负责管理其他的进程。

## ANSI C标准

C 语言诞生后的很长一段时期内，并没有针对 C 语言制定严格的标准。不同编译器可能使用不同的语法规则或薮据结构，此状况给程序的移植带来很多庥烦。于是，美国国家标准协会（ANSI）决定统一 C 语言的标准，并于 1989 年颁布 ANSX3.159-1989 标准文档，这一标准被称为 ANSI C 标准。ANSI C 标准在订立时吸取了很多 C++ 语言的内容，同时促使 C 语言支持多国字符集，其中包括各种中文字符集。ANS Ⅰ C 标准的推出使 C 语言保持着活力，成为最受开发者欢迎的开发语言。

1999 年，ANSI 推出了 C 语言标准的修订版，该修订版简称 C99。GCC 编译器和 GDB 调试器均以 ANSI C 标准为原则，同时也支持 C99。

### 函数原型

C语言设计的程序是由函数所组成的，在函数被详细定义前，可先在头文件定义函数原型，这样函数间可更容易地相互调用。

头文件 `<unistd.h>` 包含了许多 Linux 系统服务的函数原型，例如 read、write 和 getpid 函数，它们的原型如下：

```c
ssize_t read(int, void *, size_t);
ssize_t write(int, const void *, size_t);
pid_t getpid(void);
```


函数原型由函数的返回类型、函数名和参数3部分组成。例如第一行中 ssize_t 表示该函数返回值是 ssize_t 类型的值。括号中是参数列表，多个参数用逗号分隔，代码中最后行 getpid 函数的参数是 void，表示 getpido函数没有参数。

当源代码编译时，因为编译器已经知道参数的类型，所以会将调用的参数进行强制转换。

### 类属指针

类属指针是一种能够同时支持所有数据类型的指针。函数原型中常用的 “void *” 类型即是类属指针。ANSI C 标准常用类属指针代替函数参数中的其他指针，使同一个函数能支持多种数据类型。

### 原始系统数据类型

在函数原型中以 “t” 结尾的类型被称为原始系统数据类型。原始系统数据类型定义在头文件 `sys/types.h` 中，以 `typedef` 操作符加以定义。原始系统数据类型是目标系统数据结构的接口，在不同的操作系统中，其字长会有变化。

## 编译 hello world

### 使用Ⅵ编写源代码

Ⅵ 是 Linux 系统中最常用的文本编辑器，几乎所有 Linux 发行版中都已包含Ⅵ I 程序。

它工作在控制台或终端中，通过 shell 调用，全部操作均由命令完成。

```c
#include <stdio.h>

int main() {
    char *c;
    c = "hello world";
    printf("%s\n", c);
    return 0;
}
```

### 程序的编译与连接

```shell
gcc -o helloworld helloworld.c
```

### 使用终端运行程序

```shell
./helloworld
```

## GDB 调试器

### GDB 调试器概述

Linux 程序员中最常用的调试工具是 GDB。GDB 调试器是 GNU 项目的子项目。该程序提供了所有常用调试功能，是 Linux 系统中最为简单快捷的调试工具。由于当前图形用户界面（GU Ⅰ）普及，大量基于 GUI 的调试器被开发和运行在 Linux 上。它们大多是以 GDB 为核心配上 GUI，即用户通过 GUI 发出命令，这些命令依次被传送给 GDB。其中一个是 DDD，意为数据显示调试器。

### GDB 调试器安装

```shell
apt install gdb -y
```

### GDB 常用调试命令

GDB 调试器调试的对象是可执行文件，使用 GCC 或 G++ 编译器编译源代码时，必须加上选项 -g 才能使目标可执行文件包含可被调试的信息。以 helloworld 程序为例，编译连接程序，并使用 GDB 调试器打开目标可执行文件的命令如下：

```shell
gcc -g -o helloworld helloworld.c
gdb helloworld
```

![](../assets/images/表3.3_常用GDB命令.png)

### 在GDB下运行程序

打开可执行文件后，可根据需要在程序中加入断点或观察点，并运行程序。以 helloworld 程序为例，可在为变量赋值前加入断点，并运行程序。

```shell
(gdb) break 5
(gdb) run
```

### 检查数据

在程序中加入断点后，程序运行时会在断点处暂时停止，以便检查程序中的数据。通过检査数据可判断出许多种错误的所在。helloworld 程序在第 5 行加入了断点，这时第 5 行的代码并未执行。检查变量 c 的值可输入如下命令：

```shell
(gdb) print c
```

该结果表明变量 c 所指向的地址为 0x4e54e4。继续执行程序，使用单步执行方式，再检查变量 c 的值，输入下列命令：

```shell
(gdb) next
(gdb) print c
```
